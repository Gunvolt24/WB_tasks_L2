### –û—Ç–≤–µ—Ç –Ω–∞ L2.3

---
–û—Ç–ª–∏—á–Ω–∞—è –∑–∞–¥–∞—á–∞ —Å –ø–æ–¥–≤–æ—Ö–æ–º! üëç

---
–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
1. https://github.com/golang/go/blob/master/src/internal/abi/iface.go#L14
2. https://github.com/golang/go/blob/253dd08f5df3a45eafc97eec388636fcabfe0174/src/runtime/runtime2.go#L978
3. https://habr.com/ru/articles/449714/
4. https://medium.com/@AlexanderObregon/go-interfaces-behind-the-scenes-f8812706f2c5
5. https://yourbasic.org/golang/gotcha-why-nil-error-not-equal-nil/ 
6. https://medium.com/@ben.meehan_27368/understanding-nil-in-go-interfaces-typed-nil-and-common-pitfalls-6b1154718e00 


---

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–≤–µ–¥–µ—Ç: 
`<nil>`
`false`

---

#### –ß—Ç–æ —Ç—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

–í —Ñ—É–Ω–∫—Ü–∏–∏ Foo():

``` go
func Foo() error {
	var err *os.PathError = nil
	return err
}
```

1. `func Foo() error {` - —Ç—É—Ç –≤–∞–∂–Ω–æ —Ç–æ, —á—Ç–æ –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `error`. `error` - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```go
type error interface {
    Error() string
}
```

1.1. –ï—Å–ª–∏ –∫–æ–ø–∞—Ç—å –≥–ª—É–±–∂–µ –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –Ω–µ–ø—É—Å—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - –º—ã —É–≤–∏–¥–∏–º:

```go
// go/src/runtime/runtime2.go

type itab = abi.ITab

type iface struct {
	tab  *itab
	data unsafe.Pointer
}
```

```go
// go/src/internal/abi/iface.go

// The first word of every non-empty interface type contains an *ITab.
// It records the underlying concrete type (Type), the interface type it
// is implementing (Inter), and some ancillary information.
//
// allocated in non-garbage-collected memory
type ITab struct {
	Inter *InterfaceType
	Type  *Type
	...
}

// NonEmptyInterface describes the layout of an interface that contains any methods.
type NonEmptyInterface struct {
	ITab *ITab
	Data unsafe.Pointer
}
```
–ó–¥–µ—Å—å –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ–ø—É—Å—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Ö—Ä–∞–Ω–∏—Ç –≤ —Å–µ–±–µ **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–π —Ç–∏–ø** - `*InterfaceType` (–≤ —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞—á–∏ - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `error`) –∏ **–ö–æ–Ω—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø** - `*Type` (`*os.PathError`). 

2. `var err *os.PathError = nil` - —Ç—É—Ç –æ–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `err` —Å —Ç–∏–ø–æ–º `*os.PathError` –∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –µ–π `nil` –∑–Ω–∞—á–µ–Ω–∏–µ (!) - —Ç–∏–ø –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∂–µ `*os.PathError` (!). 
**–¢–æ –µ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏: [—Ç–∏–ø = `*os.PathError`, –∑–Ω–∞—á–µ–Ω–∏–µ = `nil`]**
---

–í main —Ñ—É–Ω–∫—Ü–∏–∏:

```go
func main() {
	err := Foo()
	fmt.Println(err)
	fmt.Println(err == nil)
}
```

1. `err := Foo()` - –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π;
2. `fmt.Println(err)` - –ø–µ—á–∞—Ç–∞–µ–º **–∑–Ω–∞—á–µ–Ω–∏–µ** `err` => –í—ã–≤–æ–¥:    `[nil]` (–ø–µ—á–∞—Ç–∞–µ—Ç—Å—è nil-–∑–Ω–∞—á–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏, –Ω–æ —ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å nil)
3. `fmt.Println(err == nil)` - –≤–æ—Ç —Ç—É—Ç –ø–æ–¥–≤–æ—Ö. –ö–∞–∫ –±—ã–ª–æ —Å–∫–∞–∑–∞–Ω–æ —Ä–∞–Ω–µ–µ —Ñ—É–Ω–∫—Ü–∏—è `Foo()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Ç–∏–ø [nil, *os.PathError] –∏ —Ç—É—Ç –º—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å nil, —Ç.–µ. —Å –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏ —Ç–∏–ø–æ–º [nil, nil]. => –í—ã–≤–æ–¥: `false` (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –ø—É—Å—Ç: —É –Ω–µ–≥–æ –µ—Å—Ç—å —Ç–∏–ø (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π nil)).

---
### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 

–ü–æ —Å—É—Ç–∏, —Ä–∞–∑–ª–∏—á–∏—è —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–≤—ã—Ö —Å–ª–æ–≤–∞—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.

1. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `(interface{} / any)`:
```go
type EmptyInterface struct {
    Type *Type            // –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è
    Data unsafe.Pointer   // –∞–¥—Ä–µ—Å –¥–∞–Ω–Ω—ã—Ö
}
```
- –ó–¥–µ—Å—å –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–∞–∑—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø. –ù–∏–∫–∞–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤.

---
2. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–ø—É—Å—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```go
type NonEmptyInterface struct {
    ITab *ITab            // —Ç–∞–±–ª–∏—Ü–∞: (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–π —Ç–∏–ø, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø, –º–µ—Ç–æ–¥—ã)
    Data unsafe.Pointer   // –∞–¥—Ä–µ—Å –¥–∞–Ω–Ω—ã—Ö
}

type ITab struct {
    Inter *InterfaceType  // —Å–∞–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–π —Ç–∏–ø (–º–µ—Ç–æ–¥–Ω—ã–π –Ω–∞–±–æ—Ä)
    Type  *Type           // –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è
    Hash  uint32
    Fun   [1]uintptr      // —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç–æ–¥–æ–≤ 
}
```

- –ü–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ - `*ITab`, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–≤—è–∑–∫–∞ **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–π —Ç–∏–ø + –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø** –∏ —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç–æ–¥–æ–≤.
---

### –í—ã–≤–æ–¥:

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ - —ç—Ç–æ –ø–∞—Ä–∞:

- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ç–∏–ø (—É –ø—É—Å—Ç–æ–≥–æ: `*Type`, —É –Ω–µ–ø—É—Å—Ç–æ–≥–æ: `*ITab` —Å `Inter+Type`);
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - `Data`.

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è `nil` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±–∞ —Å–ª–æ–≤–∞ —Ä–∞–≤–Ω—ã `nil`: –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ç–∏–ø (`Type/ITab`), –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (`Data`). –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É "—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π nil" (–Ω–∞–ø—Ä–∏–º–µ—Ä, `(*T)(nil)` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –¥–∞—ë—Ç) `iface != nil`.

–†–µ—à–µ–Ω–∏–µ–º —Ç–∞–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –†–µ—Ñ–ª–µ–∫—Å–∏–∏.

